{% extends "base.html" %}

{% block title %}Trade - Student Trading{% endblock %}

{% block content %}
<h1>Place Order</h1>

{% if error %}
<div class="error">{{ error }}</div>
{% endif %}

{% if success %}
<div class="success">
    <p><strong>Order submitted successfully!</strong></p>
    <p>Order ID: {{ order.order_id }}</p>
    <p>Status: {{ order.status }}</p>
</div>
{% endif %}

<div class="card">
    <form method="post" action="/trade">
        <div>
            <label for="ticker">Stock</label>
            <select id="ticker" name="ticker" required>
                <option value="">Select a stock...</option>
                {% for company in companies %}
                <option value="{{ company.ticker }}"
                        {{ 'selected' if selected_ticker == company.ticker else '' }}>
                    {{ company.ticker }} - {{ company.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="side">Side</label>
            <select id="side" name="side" required>
                <option value="buy">Buy</option>
                <option value="sell">Sell</option>
            </select>
        </div>

        <div>
            <label for="order_type">Order Type</label>
            <select id="order_type" name="order_type" required onchange="togglePrice()">
                <option value="market">Market</option>
                <option value="limit">Limit</option>
            </select>
        </div>

        <div>
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" required
                   min="1" value="1">
        </div>

        <div id="price-field" style="display: none;">
            <label for="price">Limit Price ($)</label>
            <input type="number" id="price" name="price"
                   min="0.01" step="0.01" placeholder="0.00">
        </div>

        <button type="submit" class="success">Submit Order</button>
    </form>
</div>

<script>
function togglePrice() {
    var orderType = document.getElementById('order_type').value;
    var priceField = document.getElementById('price-field');
    var priceInput = document.getElementById('price');
    if (orderType === 'limit') {
        priceField.style.display = 'block';
        priceInput.required = true;
    } else {
        priceField.style.display = 'none';
        priceInput.required = false;
    }
}
</script>

<p class="text-muted">
    <a href="/market">View Market</a> | <a href="/portfolio">View Portfolio</a>
</p>
{% endblock %}
